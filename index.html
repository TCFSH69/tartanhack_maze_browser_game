<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><style>body{margin:0;overflow:hidden;background:#000;color:#fff;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;touch-action:none}canvas{display:block;image-rendering:pixelated}#ui{position:absolute;top:10px;left:10px;z-index:10;pointer-events:none;text-shadow:1px 1px 2px #000;font-weight:700}#effects-ui{margin-top:6px;opacity:.9;font-size:12px;font-weight:700}#objective-ui{margin-top:6px;font-size:12px;font-weight:800;letter-spacing:.2px;opacity:.95}.chk{opacity:.85}.ok{color:rgba(0,255,0,.95);text-shadow:0 0 12px rgba(0,255,0,.2)}.no{color:rgba(255,255,255,.85)}#toast{position:absolute;top:18px;left:50%;transform:translateX(-50%);z-index:40;background:rgba(0,0,0,.72);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:10px 14px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.55),0 0 18px rgba(255,200,0,.18);font-weight:900;font-size:13px;letter-spacing:.2px;opacity:0;pointer-events:none;transition:opacity 180ms ease,transform 180ms ease}#toast.show{opacity:1;transform:translateX(-50%) translateY(6px)}#toast .sub{display:block;font-weight:800;opacity:.85;font-size:12px;margin-top:3px}#start-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:20px 40px;font-size:24px;font-weight:900;background:#0f0;color:#000;border:3px solid #fff;cursor:pointer;border-radius:14px;box-shadow:0 0 18px rgba(0,255,0,.85),0 12px 30px rgba(0,0,0,.65);z-index:20}#controls-hint{position:absolute;bottom:10px;width:100%;text-align:center;color:#888;font-size:12px;pointer-events:none}#flash-btn{position:absolute;top:10px;right:10px;z-index:20;padding:10px 18px;font-size:14px;font-weight:700;background:#fff;color:#000;border:2px solid gold;cursor:pointer;border-radius:10px;box-shadow:0 0 10px rgba(255,255,255,.5)}#flash-btn:disabled{opacity:.3;cursor:default}#flash-overlay{display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:25;align-items:center;justify-content:center;flex-direction:column;background:#fff;opacity:1;transition:opacity 2s ease,background 1.2s ease}#flash-overlay.fade-out{opacity:0}#flash-overlay img{max-width:70%;max-height:50%;object-fit:contain;opacity:0;transition:opacity 1.2s ease;filter:drop-shadow(0 0 40px rgba(255,255,255,.8))}#flash-overlay.show-ad{background:rgba(0,0,0,.9)}#flash-overlay.show-ad img{opacity:1}.end-screen{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:30;align-items:center;justify-content:center;text-align:center;flex-direction:column}.end-screen h1{font-size:60px;margin:0;letter-spacing:5px}.end-screen p{font-size:20px;margin:5px 0}#win h1{color:gold;text-shadow:0 0 20px gold}#lose h1{color:red;text-shadow:0 0 20px red}.start-panel{position:absolute;top:50%;left:50%;width:340px;padding:16px 18px;border-radius:18px;background:rgba(10,14,18,.78);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);color:rgba(255,255,255,.92);box-shadow:0 0 18px rgba(0,255,0,.18),0 10px 30px rgba(0,0,0,.55);pointer-events:none;user-select:none;z-index:19;opacity:0;transform-origin:center;animation:panelIn .7s ease forwards}@keyframes panelIn{from{opacity:0;filter:blur(2px)}to{opacity:1;filter:blur(0)}}.start-panel h3{margin:0 0 8px 0;font-size:14px;letter-spacing:1px;text-transform:uppercase;color:rgba(0,255,0,.95);text-shadow:0 0 10px rgba(0,255,0,.25);display:flex;align-items:center;gap:8px}.start-panel ul{margin:0;padding-left:18px;line-height:1.55;font-size:13px;color:rgba(255,255,255,.9)}.start-panel li{margin:6px 0}.kbd{display:inline-block;padding:2px 7px;margin:0 2px;border-radius:9px;background:rgba(255,255,255,.12);box-shadow:inset 0 0 0 1px rgba(255,255,255,.14);font-weight:800;font-size:12px;letter-spacing:.5px}.pulse-hint{position:absolute;top:50%;left:50%;transform:translate(-50%,calc(-50% + 95px));z-index:19;pointer-events:none;user-select:none;font-size:13px;color:rgba(255,255,255,.75);text-shadow:0 0 12px rgba(0,0,0,.8);animation:pulse 1.2s ease-in-out infinite}@keyframes pulse{0%,100%{opacity:.55}50%{opacity:1}}#panel-top{transform:translate(-50%,calc(-50% - 230px))}#panel-left{transform:translate(calc(-50% - 450px),-50%)}#panel-right{transform:translate(calc(-50% + 450px),-50%)}#panel-bottom{transform:translate(-50%,calc(-50% + 210px));width:520px}@media (max-width:980px){.start-panel{width:300px}#panel-top{transform:translate(-50%,calc(-50% - 240px))}#panel-left{transform:translate(-50%,calc(-50% + 200px))}#panel-right{transform:translate(-50%,calc(-50% + 355px))}#panel-bottom{transform:translate(-50%,calc(-50% + 510px));width:300px}.pulse-hint{transform:translate(-50%,calc(-50% + 110px))}}</style></head><body><div id="toast">‚ö†Ô∏è You can't escape yet! <span class="sub">Find at least one üåÄ and one üîÄ first.</span></div><div id="ui">Mic Level: <span id="mic-val">0</span><br>Ghosts: <span id="ghost-count">5</span><div id="effects-ui"></div><div id="objective-ui"></div></div><div id="panel-top" class="start-panel"><h3>üéØ Objective</h3><ul><li>Collect at least <b>one</b> üåÄ <b>and</b> <b>one</b> üîÄ.</li><li>Then touch the <span class="kbd">üèÅ</span> flag to <b>escape</b>.</li><li>Avoid ghosts üëª ‚Äî touching one = üíÄ</li></ul></div><div id="panel-left" class="start-panel"><h3>üïπÔ∏è Movement</h3><ul><li>Keyboard: <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span></li><li>Mobile: left joystick to move üëà</li></ul></div><div id="panel-right" class="start-panel"><h3>üéÆ Aim & Shoot</h3><ul><li>Mouse: aim direction üñ±Ô∏è</li><li>Mobile: right joystick to aim üëâ</li><li><b>Scream</b> to shoot üé§ (mic loudness)</li></ul></div><div id="panel-bottom" class="start-panel"><h3>üí• Tools & Powerups</h3><ul><li><span class="kbd">Flash Grenade</span> (one-time): reveals the whole map briefly ‚ú®</li><li>üîÄ <b>Invert</b> (10s): movement flips (W‚ÜîS, A‚ÜîD). Shooting unaffected.</li><li>üåÄ <b>Wobble</b> (10s): camera shakes/wobbles.</li><li>üõ°Ô∏è <b>Invincible</b> (5s): ghosts can‚Äôt kill you.</li></ul></div><div id="start-hint" class="pulse-hint">‚ú® Click <b>START ESCAPE</b> to begin</div><button id="start-btn">START ESCAPE</button><div id="controls-hint">WASD to Move | Mouse to Aim | Scream to Shoot</div><button id="flash-btn">Flash Grenade</button><canvas id="gameCanvas"></canvas><div id="flash-overlay"><img src="27e3d95f-7921-4231-9fad-420a3afd34d2_1251x779.webp" alt="AppLovin"></div><div id="win" class="end-screen"><div><h1>ESCAPED</h1><p>You found the goal.</p><p style="opacity:.7;margin-top:15px;font-size:14px">(Click anywhere to restart)</p></div></div><div id="lose" class="end-screen"><div><h1>YOU DIED</h1><p>You have been caught.</p><p style="opacity:.7;margin-top:15px;font-size:14px">(Click anywhere to restart)</p></div></div><script>(()=>{const e=Math,t=e.floor,n=e.random,i=e.abs,l=e.ceil,r=e.sin,a=e.cos,o=e.PI,s=e.min,c=e.max,u=e.round,f=e.atan2,h=e.pow,d=2*e.PI,y=e=>document.getElementById(e),g=AudioParam.prototype;g.e=g.exponentialRampToValueAtTime,g.v=g.setValueAtTime;const p=EventTarget.prototype;let v;function x(){return v||(v=new AudioContext),"suspended"===v.state&&v.resume(),v}p.on=p.addEventListener;const w={invert:{emoji:"üîÄ",durationMs:1e4},wobble:{emoji:"üåÄ",durationMs:1e4},invincible:{emoji:"üõ°Ô∏è",durationMs:5e3}},m=y("gameCanvas"),b=m.getContext("2d"),T=y("mic-val"),D=y("ghost-count"),X=y("effects-ui"),Y=y("objective-ui"),k=y("toast"),S=y("start-btn"),A=y("win"),C=y("lose"),q=y("panel-top"),U=y("panel-left"),$=y("panel-right"),B=y("panel-bottom"),R=y("start-hint");function G(e){const t=e?"block":"none";q.style.display=t,U.style.display=t,$.style.display=t,B.style.display=t,R.style.display=t}G(1);const I=new Image;I.src="player.jpg";let P=0;I.onload=()=>{P=1};const O=new Image;O.src="ghost.jpg";let W=0;O.onload=()=>{W=1};let L,j,M,z,E,F=[],H={x:1,y:1,dirX:0,dirY:1,aimDirX:0,aimDirY:1,moveTimer:0},N={x:0,y:0},K=[],V=0,Q=[],J=0,Z=0,_=0,ee=0,te=[],ne=null,ie={startX:0,startY:0,currX:0,currY:0,active:0},le=null,re={startX:0,startY:0,currX:0,currY:0,active:0},ae={x:0,y:0},oe=[],se={invertUntil:0,wobbleUntil:0,invincibleUntil:0},ce={gotInvert:0,gotWobble:0},ue=null;function fe(){const e=ce.gotInvert,t=ce.gotWobble;Y.innerHTML=`Objective: <span class="chk ${t?"ok":"no"}">üåÄ ${t?"OK":"0/1"}</span>  <span class="chk ${e?"ok":"no"}">üîÄ ${e?"OK":"0/1"}</span>  ‚Üí <span class="chk ${t&&e?"ok":"no"}">üèÅ Escape</span>`}function he(e,t){return e>=0&&e<31&&t>=0&&t<31&&1===F[t][e]}function de(e,t){return oe.some(n=>n.x===e&&n.y===t)}function ye(e){const t=Date.now(),n=w[e].durationMs;"invert"===e&&(se.invertUntil=c(se.invertUntil,t+n),ce.gotInvert=1),"wobble"===e&&(se.wobbleUntil=c(se.wobbleUntil,t+n),ce.gotWobble=1),"invincible"===e&&(se.invincibleUntil=c(se.invincibleUntil,t+n)),fe()}class ge{constructor(e,t){this.x=20*e,this.y=20*t,this.size=18,this.color="red",this.speed=.25,this.targetX=this.x,this.targetY=this.y,this.isDead=0,this.respawnTimer=0}update(e,t){if(this.isDead)return this.respawnTimer--,void(this.respawnTimer<=0&&this.respawn(e,t));if(i(this.x-this.targetX)+i(this.y-this.targetY)<this.speed){this.x=this.targetX,this.y=this.targetY;let n=u(this.x/20),i=u(this.y/20),l=this.bfs(n,i,e.x,e.y,t);l&&(this.targetX=20*l.x,this.targetY=20*l.y)}this.x<this.targetX&&(this.x+=this.speed),this.x>this.targetX&&(this.x-=this.speed),this.y<this.targetY&&(this.y+=this.speed),this.y>this.targetY&&(this.y-=this.speed)}respawn(e,l){let r=100;for(;r-- >0;){let r=t(31*n()),a=t(31*n());if(1===l[a][r]&&i(r-e.x)+i(a-e.y)>15){this.x=20*r,this.y=20*a,this.targetX=this.x,this.targetY=this.y,this.isDead=0;break}}}bfs(e,t,n,i,l){if(e===n&&t===i)return null;let r=[{x:e,y:t}],a={},o=`${e},${t}`;a[o]=null;let s=0,c=0;for(;r.length>0&&c<500;){c++;let e=r.shift();if(e.x===n&&e.y===i){s=1;break}for(let[t,n]of[[0,-1],[0,1],[-1,0],[1,0]]){let i=e.x+t,o=e.y+n,s=`${i},${o}`;i>=0&&i<31&&o>=0&&o<31&&1===l[o][i]&&!a.hasOwnProperty(s)&&(r.push({x:i,y:o}),a[s]={x:e.x,y:e.y})}}if(!s)return null;let u=`${n},${i}`,f=[];if(!a[u])return null;for(;u!==o;){let e=u.split(",").map(Number);f.push({x:e[0],y:e[1]});let t=a[u];u=`${t.x},${t.y}`}return f[f.length-1]}checkCollision(e){if(this.isDead)return 0;let t=20*e.x,n=20*e.y;return this.x<t+20-4&&this.x+this.size>t+4&&this.y<n+20-4&&this.y+this.size>n+4}draw(e,t,n){if(this.isDead)return;let i=this.x+t,l=this.y+n;if(W)return void e.drawImage(O,i,l,this.size,this.size);e.fillStyle=this.color,e.fillRect(i,l,this.size,this.size);let r=this.targetX>this.x?2:this.targetX<this.x?-2:0,a=this.targetY>this.y?2:this.targetY<this.y?-2:0;e.fillStyle="white",e.fillRect(i+4+r,l+4+a,5,5),e.fillRect(i+10+r,l+4+a,5,5)}}function pe(e,n){if(!e.active)return;let i=e.startX/3,l=e.startY/3,r=e.currX/3,a=e.currY/3;b.beginPath(),b.arc(i,l,40/3,0,d),b.fillStyle="rgba(255, 255, 255, 0.2)",b.fill(),b.strokeStyle="rgba(255, 255, 255, 0.4)",b.lineWidth=2,b.stroke(),b.beginPath(),b.arc(r,a,20/3,0,d),b.fillStyle="rgba(255, 255, 255, 0.5)",b.fill(),b.fillStyle="#fff",b.font=t(4)+"px sans-serif",b.textAlign="center",b.fillText(n,i,l+20)}function ve(e){ee=0,"win"===e?A.style.display="flex":(function(){let e=x(),t=e.currentTime,i=e.createOscillator(),l=e.createGain();i.type="sawtooth",i.frequency.v(500,t),i.frequency.e(40,t+.8),l.gain.v(1,t),l.gain.e(.01,t+.8),i.connect(l),l.connect(e.destination),i.start(),i.stop(t+.8);let r=e.createBuffer(1,.5*e.sampleRate,e.sampleRate),a=r.getChannelData(0);for(let e=0;e<a.length;e++)a[e]=2*n()-1;let o=e.createBufferSource(),s=e.createGain();o.buffer=r,s.gain.v(.8,t),s.gain.e(.01,t+.5),o.connect(s),s.connect(e.destination),o.start()}(),C.style.display="flex")}function xe(){location.reload()}function we(){if(function(){if(!z)return;z.getByteFrequencyData(E);let e=0;for(let t=0;t<E.length;t++)e+=E[t];let n=e/E.length;_=s(10,t(n/10)),T.innerText=_+` (dB: ${t(n)})`,ee&&n>10&&Date.now()-V>400&&(K.push({x:20*H.x+10,y:20*H.y+10,vx:4*H.aimDirX,vy:4*H.aimDirY}),function(){let e=x(),t=e.currentTime,n=e.createOscillator(),i=e.createGain();n.type="sine",n.frequency.v(1500,t),n.frequency.e(200,t+.15),i.gain.v(.8,t),i.gain.e(.01,t+.15),n.connect(i),i.connect(e.destination),n.start(),n.stop(t+.15)}(),V=Date.now())}(),function(){const e=Date.now(),t=[];e<se.invertUntil&&t.push(`üîÄ Invert: ${l((se.invertUntil-e)/1e3)}s`),e<se.wobbleUntil&&t.push(`üåÄ Wobble: ${l((se.wobbleUntil-e)/1e3)}s`),e<se.invincibleUntil&&t.push(`üõ°Ô∏è Invincible: ${l((se.invincibleUntil-e)/1e3)}s`),X.innerText=t.length?t.join(" | "):""}(),fe(),ee){(function(){if(re.active){let e=re.currX-re.startX,t=re.currY-re.startY;(i(e)>10||i(t)>10)&&(i(e)>i(t)?(H.aimDirX=e>0?1:-1,H.aimDirY=0):(H.aimDirX=0,H.aimDirY=t>0?1:-1))}else{let e=window.innerWidth/2,t=window.innerHeight/2,n=ae.x-e,l=ae.y-t;0===n&&0===l||(i(n)>i(l)?(H.aimDirX=n>0?1:-1,H.aimDirY=0):(H.aimDirX=0,H.aimDirY=l>0?1:-1))}})(),function(){if(H.moveTimer>0)return void H.moveTimer--;let e=0,t=0;if(ie.active){let n=ie.currX-ie.startX,l=ie.currY-ie.startY;(i(n)>20||i(l)>20)&&(i(n)>i(l)?e=n>0?1:-1:t=l>0?1:-1)}else if(te.length>0){const n=te[te.length-1];"w"===n||"ArrowUp"===n?t=-1:"s"===n||"ArrowDown"===n?t=1:"a"===n||"ArrowLeft"===n?e=-1:"d"!==n&&"ArrowRight"!==n||(e=1)}if(Date.now()<se.invertUntil&&(e*=-1,t*=-1),0!==e||0!==t){H.dirX=e,H.dirY=t;let n=H.x+e,i=H.y+t;if(n>=0&&n<31&&i>=0&&i<31&&1===F[i][n]){H.x=n,H.y=i,H.moveTimer=10,function(){for(let e=oe.length-1;e>=0;e--){const t=oe[e];t.x===H.x&&t.y===H.y&&(ye(t.type),oe.splice(e,1))}}();let e=0;if(0===F[H.y-1]?.[H.x]&&e++,0===F[H.y+1]?.[H.x]&&e++,0===F[H.y]?.[H.x-1]&&e++,0===F[H.y]?.[H.x+1]&&e++,e>=3&&function(){let e=x(),t=e.currentTime;for(let n=0;n<2;n++){let i=e.createOscillator(),l=e.createGain();i.type="square",i.frequency.v(200,t+.15*n),l.gain.v(.8,t+.15*n),l.gain.e(.01,t+.15*n+.1),i.connect(l),l.connect(e.destination),i.start(t+.15*n),i.stop(t+.15*n+.1)}}(),H.x===N.x&&H.y===N.y)if(ce.gotInvert&&ce.gotWobble)ve("win");else{const e=ce.gotWobble?"":"üåÄ",t=ce.gotInvert?"":"üîÄ";!function(e,t){k.innerHTML=`‚ö†Ô∏è You can‚Äôt escape yet!<span class="sub">${t}</span>`,k.classList.add("show"),ue&&clearTimeout(ue),ue=setTimeout(()=>k.classList.remove("show"),1800)}(0,`Find ${e}${e&&t?" and ":""}${t} first.`)}}}}(),function(){for(let e=K.length-1;e>=0;e--){let n=K[e];n.x+=n.vx,n.y+=n.vy;let i=t(n.x/20),l=t(n.y/20);if(i<0||i>=31||l<0||l>=31||0===F[l][i])K.splice(e,1);else for(let t of Q)if(!t.isDead&&n.x>t.x&&n.x<t.x+t.size&&n.y>t.y&&n.y<t.y+t.size){t.isDead=1,t.respawnTimer=300,K.splice(e,1);break}}}();const e=Date.now()<se.invincibleUntil;for(let t of Q)if(J||t.update(H,F),!e&&t.checkCollision(H))return void ve("lose")}(function(){m.style.width=window.innerWidth+"px",m.style.height=window.innerHeight+"px",m.width=c(1,t(window.innerWidth/3)),m.height=c(1,t(window.innerHeight/3)),b.imageSmoothingEnabled=0;const e=Date.now();let n,i,o,u,h,y,g=1;if(J){let e=620,t=620;g=.9*s(m.width/e,m.height/t)}if(J)n=m.width/2-620*g/2,i=m.height/2-620*g/2,b.save(),b.translate(n,i),b.scale(g,g),n=0,i=0;else if(n=m.width/2-20*H.x-10,i=m.height/2-20*H.y-10,e<se.wobbleUntil){const t=.015*e;n+=8*r(t),i+=8*a(1.3*t)}if(b.fillStyle="#000",b.fillRect(0,0,m.width,m.height),J)o=0,u=0,h=30,y=30;else{let e=l(m.width/20),r=l(m.height/20);o=t(-n/20),u=t(-i/20),h=o+e,y=u+r}for(let e=u;e<=y;e++)for(let t=o;t<=h;t++)if(e>=0&&e<31&&t>=0&&t<31){let l=20*t+n,r=20*e+i;b.fillStyle=0===F[e][t]?"#555":"#222",b.fillRect(l,r,20,20)}b.save(),b.font=`${c(8,t(18))}px Arial`,b.textAlign="center",b.textBaseline="middle";for(const e of oe){const t=20*e.x+n+10,l=20*e.y+i+10;b.shadowColor="rgba(255,255,255,0.35)",b.shadowBlur=10,b.fillText(e.emoji,t,l)}b.restore(),b.fillStyle="#ffff00";for(let e of K)b.beginPath(),b.arc(e.x+n,e.y+i,4,0,d),b.fill();let p=20*H.x+n,v=20*H.y+i;e<se.invincibleUntil&&(b.save(),b.strokeStyle="rgba(0,255,255,0.9)",b.lineWidth=3,b.shadowColor="rgba(0,255,255,0.8)",b.shadowBlur=18,b.strokeRect(p-3,v-3,26,26),b.restore()),P?b.drawImage(I,p,v,20,20):(b.fillStyle="#0f0",b.fillRect(p,v,20,20),b.fillStyle="#000",b.beginPath(),b.arc(p+10+6*H.dirX,v+10+6*H.dirY,2.2,0,d),b.fill());let x=v+10,w=p+10+40*H.aimDirX,T=x+40*H.aimDirY;b.save(),b.strokeStyle="#ff0000",b.lineWidth=3,b.shadowColor="#ff0000",b.shadowBlur=15,b.beginPath(),b.arc(w,T,10,0,d),b.moveTo(w-14,T),b.lineTo(w+14,T),b.moveTo(w,T-14),b.lineTo(w,T+14),b.stroke(),b.restore();let X=0;for(let e of Q)e.draw(b,n,i),e.isDead||X++;D.innerText=X;let Y=20*N.x+n,k=20*N.y+i;b.fillStyle="gold",b.font="16px Arial",b.fillText("üö©",Y,k+16);let S=p+10,A=v+10;if(J&&b.restore(),!J){L||(L=document.createElement("canvas"),j=L.getContext("2d")),L.width=m.width,L.height=m.height,j.globalCompositeOperation="source-over",j.fillStyle="#000",j.fillRect(0,0,L.width,L.height),j.globalCompositeOperation="destination-out";let e=100,t=j.createRadialGradient(S,A,0,S,A,e);t.addColorStop(0,"rgba(0,0,0,1)"),t.addColorStop(.6,"rgba(0,0,0,0.5)"),t.addColorStop(1,"rgba(0,0,0,0)"),j.fillStyle=t,j.beginPath(),j.arc(S,A,e,0,d),j.fill();for(let e of K)j.beginPath(),j.arc(e.x+n,e.y+i,30,0,d),j.fillStyle="rgba(0,0,0,1)",j.fill();b.drawImage(L,0,0)}pe(ie,"Move"),pe(re,"Aim");let C=f(N.y-H.y,N.x-H.x),q=S+80*a(C),U=A+80*r(C);b.save(),b.translate(q,U),b.rotate(C),b.beginPath(),b.moveTo(14,0),b.lineTo(-14,-8.4),b.lineTo(.4*-14,0),b.lineTo(-14,8.4),b.closePath(),b.fillStyle="rgb(255,255,255)",b.shadowColor="rgb(255,255,255)",b.shadowBlur=10,b.fill(),b.restore()})(),requestAnimationFrame(we)}A.on("click",xe),C.on("click",xe);const me=y("flash-btn"),be=y("flash-overlay");function Te(e){e.preventDefault();for(let t=0;t<e.changedTouches.length;t++){let n=e.changedTouches[t];n.identifier===ne?(ne=null,ie.active=0):n.identifier===le&&(le=null,re.active=0)}}me.on("click",()=>{!Z&&ee&&(Z=1,me.disabled=1,function(){let e=x(),t=e.currentTime,i=e.createOscillator(),l=e.createGain();i.type="sine",i.frequency.v(2e3,t),i.frequency.e(500,t+1),l.gain.v(1,t),l.gain.e(.01,t+1),i.connect(l),l.connect(e.destination),i.start(),i.stop(t+1);let r=e.createOscillator(),a=e.createGain();r.type="triangle",r.frequency.v(150,t),a.gain.v(.7,t),a.gain.e(.01,t+1.2),r.connect(a),a.connect(e.destination),r.start(),r.stop(t+1.2);let o=e.createBuffer(1,.3*e.sampleRate,e.sampleRate),s=o.getChannelData(0);for(let e=0;e<s.length;e++)s[e]=2*n()-1;let c=e.createBufferSource(),u=e.createGain();c.buffer=o,u.gain.v(.9,t),u.gain.e(.01,t+.3),c.connect(u),u.connect(e.destination),c.start()}(),setTimeout(()=>{be.style.display="flex",be.style.background="#fff",be.style.opacity="1",be.className="",setTimeout(()=>{be.classList.add("show-ad"),setTimeout(()=>{be.classList.add("fade-out"),be.on("transitionend",function e(){be.removeEventListener("transitionend",e),be.style.display="none",be.className="",J=1,setTimeout(()=>{J=0},2e3)})},1e3)},500)},1500))}),S.on("click",async function(){try{const e=await navigator.mediaDevices.getUserMedia({audio:1});M=new(window.AudioContext||window.webkitAudioContext),z=M.createAnalyser(),M.createMediaStreamSource(e).connect(z),z.fftSize=256,E=new Uint8Array(z.frequencyBinCount),function(){F=[];for(let e=0;e<31;e++){let e=[];for(let t=0;t<31;t++)e.push(0);F.push(e)}let e=[];for(F[1][1]=1,e.push({x:1,y:1});e.length>0;){let i=e[e.length-1],l=[],r=[{dx:0,dy:-2},{dx:0,dy:2},{dx:-2,dy:0},{dx:2,dy:0}];for(let e of r){let t=i.x+e.dx,n=i.y+e.dy;t>0&&t<30&&n>0&&n<30&&0===F[n][t]&&l.push({x:t,y:n,dx:e.dx,dy:e.dy})}if(l.length>0){let r=l[t(n()*l.length)];F[i.y+r.dy/2][i.x+r.dx/2]=1,F[r.y][r.x]=1,e.push({x:r.x,y:r.y})}else e.pop()}for(let e=1;e<30;e++)for(let t=1;t<30;t++)if(0===F[e][t]&&n()<.05){let n=0;1===F[e-1][t]&&n++,1===F[e+1][t]&&n++,1===F[e][t-1]&&n++,1===F[e][t+1]&&n++,n>=2&&(F[e][t]=1)}H.x=1,H.y=1,H.dirX=0,H.dirY=1,H.aimDirX=0,H.aimDirY=1,H.moveTimer=0,se.invertUntil=0,se.wobbleUntil=0,se.invincibleUntil=0,ce.gotInvert=0,ce.gotWobble=0,fe();let l=0;for(let e=0;e<31;e++)for(let t=0;t<31;t++)if(1===F[e][t]){let n=i(t-H.x)+i(e-H.y);n>l&&(l=n,N={x:t,y:e})}Q=[];for(let e=0;e<5;e++){let e=0;for(;!e;){let l=t(31*n()),r=t(31*n());1===F[r][l]&&i(l-H.x)+i(r-H.y)>10&&(Q.push(new ge(l,r)),e=1)}}(function(){oe=[];const e=[{x:H.x,y:H.y},{x:N.x,y:N.y}];function l(t,n){return e.some(e=>i(t-e.x)+i(n-e.y)<6)}function r(e,i){let r=0,a=0;for(;r<i&&a<5e3;){a++;const i=t(31*n()),o=t(31*n());he(i,o)&&(de(i,o)||l(i,o)||(oe.push({x:i,y:o,type:e,emoji:w[e].emoji}),r++))}}r("invert",2),r("wobble",2),r("invincible",1)})(),D.innerText=Q.length,D.style.color="white",S.style.display="none",G(0),A.style.display="none",C.style.display="none",ee=1}(),function(){if(De.playing)return;const e=De.AC||(De.AC=new(window.AudioContext||window.webkitAudioContext));if("suspended"===e.state&&e.resume(),De.playing=1,De.bpm=132,De.step=0,De.bar=0,De.nextT=e.currentTime+.05,De.lookAhead=.12,!De.master){const t=e.createGain();t.gain.value=.85;const n=e.createDynamicsCompressor();n.threshold.value=-18,n.knee.value=25,n.ratio.value=10,n.attack.value=.003,n.release.value=.22;const i=e.createDelay(1),l=e.createDelay(1);i.delayTime.value=.11,l.delayTime.value=.145;const r=e.createGain(),a=e.createGain();r.gain.value=.35,a.gain.value=.33;const o=e.createStereoPanner();o.pan.value=-.35;const s=e.createStereoPanner();s.pan.value=.35,i.connect(r),r.connect(i),l.connect(a),a.connect(l);const c=e.createGain();c.gain.value=.22,i.connect(o),o.connect(c),l.connect(s),s.connect(c),t.connect(n),c.connect(n),n.connect(e.destination),De.master=t,De.wetSend={dL:i,dR:l}}De.timer=setInterval(()=>function(){const e=De.AC;if(!De.playing||!e)return;const t=60/De.bpm/4;for(;De.nextT<e.currentTime+De.lookAhead;){const e=De.step,n=[72,null,74,null,79,null,77,null,74,null,72,null,69,null,67,null],i=[72,null,74,76,79,null,77,76,74,null,72,null,69,67,69,null],l=[84,83,81,79,77,76,74,72,71,72,74,76,77,79,81,83],r=De.bar%16;let a=n;r>=4&&r<8?a=i:r>=8&&r<12?a=n:r>=12&&(a=l);const o=[36,null,36,null,34,null,34,null,31,null,31,null,33,null,33,null],s=[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],c=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0][e]&&Se(De.nextT),s[e]&&Ae(De.nextT),c[e]&&Ce(De.nextT),e%2==0&&ke(De.nextT,o[e]??36),null!=a[e]&&Ye(De.nextT,a[e],r>=12?.1:.12),De.nextT+=t,De.step=De.step+1&15,0===De.step&&De.bar++}}(),25)}(),we()}catch(e){alert("Microphone denied! Please allow access.")}}),window.on("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","s","d"].includes(e.key)&&e.preventDefault(),te.includes(e.key)||te.push(e.key)}),window.on("keyup",e=>{te=te.filter(t=>t!==e.key)}),window.on("mousemove",e=>{ae.x=e.clientX,ae.y=e.clientY}),m.on("touchstart",e=>{e.preventDefault();for(let t=0;t<e.changedTouches.length;t++){let n=e.changedTouches[t];n.clientX<window.innerWidth/2?null===ne&&(ne=n.identifier,ie.startX=n.clientX,ie.startY=n.clientY,ie.currX=n.clientX,ie.currY=n.clientY,ie.active=1):null===le&&(le=n.identifier,re.startX=n.clientX,re.startY=n.clientY,re.currX=n.clientX,re.currY=n.clientY,re.active=1)}},{passive:0}),m.on("touchmove",e=>{e.preventDefault();for(let t=0;t<e.changedTouches.length;t++){let n=e.changedTouches[t];n.identifier===ne?(ie.currX=n.clientX,ie.currY=n.clientY):n.identifier===le&&(re.currX=n.clientX,re.currY=n.clientY)}},{passive:0}),m.on("touchend",Te),m.on("touchcancel",Te),fe();let De={playing:0};function Xe(e){return 440*h(2,(e-69)/12)}function Ye(e,t,n){const i=De.AC,l=Xe(t),a=i.createOscillator(),s=i.createGain(),c=i.createBiquadFilter(),u=i.createStereoPanner();a.type="triangle",a.frequency.v(l,e),a.frequency.e(1.01*l,e+.03),c.type="lowpass",c.frequency.v(9e3,e),c.frequency.e(1800,e+n),u.pan.v(.35*r(De.bar%8/8*o*2),e),s.gain.v(1e-4,e),s.gain.e(.28,e+.006),s.gain.e(1e-4,e+n),a.connect(c),c.connect(u),u.connect(s),s.connect(De.master),s.connect(De.wetSend.dL),s.connect(De.wetSend.dR),a.start(e),a.stop(e+n+.02)}function ke(e,t){const n=De.AC,i=Xe(t),l=n.createOscillator(),r=n.createGain(),a=n.createBiquadFilter();l.type="sawtooth",l.frequency.v(i,e),l.frequency.e(.985*i,e+.12),a.type="lowpass",a.frequency.v(600,e),a.frequency.e(220,e+.18),r.gain.v(1e-4,e),r.gain.e(.35,e+.004),r.gain.e(1e-4,e+.18),l.connect(a),a.connect(r),r.connect(De.master),l.start(e),l.stop(e+.22)}function Se(e){const t=De.AC,n=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.v(140,e),n.frequency.e(38,e+.1),i.gain.v(1e-4,e),i.gain.e(.95,e+.002),i.gain.e(1e-4,e+.18),n.connect(i),i.connect(De.master),n.start(e),n.stop(e+.2)}function Ae(e){const t=De.AC,i=t.sampleRate,l=.14*i|0,r=t.createBuffer(1,l,i),a=r.getChannelData(0);for(let e=0;e<l;e++)a[e]=(2*n()-1)*(1-e/l);const o=t.createBufferSource();o.buffer=r;const s=t.createBiquadFilter();s.type="bandpass",s.frequency.value=1800,s.Q.value=1.2;const c=t.createGain();c.gain.v(1e-4,e),c.gain.e(.55,e+.003),c.gain.e(1e-4,e+.14),o.connect(s),s.connect(c),c.connect(De.master),o.start(e),o.stop(e+.16)}function Ce(e){const t=De.AC,i=t.sampleRate,l=.03*i|0,r=t.createBuffer(1,l,i),a=r.getChannelData(0);for(let e=0;e<l;e++)a[e]=2*n()-1;const o=t.createBufferSource();o.buffer=r;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=6e3;const c=t.createGain();c.gain.v(1e-4,e),c.gain.e(.18,e+.001),c.gain.e(1e-4,e+.03),o.connect(s),s.connect(c),c.connect(De.master),o.start(e),o.stop(e+.04)}})()</script></body></html>